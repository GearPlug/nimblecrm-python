{% extends 'layouts/site_base.html' %}
{% load static %}
{% block content %}
    {% for connections in object_list %}
        <div class="col-md-12" data-connector-id="{{ connections.0.connector.id }}">
            <div class="col-md-12">
                <hr>
            </div>
            <div class="col-md-12">
                <img src="{{ connections.0.connector.icon.url }}" height="40"
                     width="40"> &nbsp;
                {{ connections.0.connector.name }}
            </div>
            {% for connection in connections %}
                {% include 'connection/snippets/connector_state.html' with c=connection %}
            {% endfor %}
        </div>
        <br>
    {% endfor %}
{% endblock %}

{% block scripts %}
    {{ block.super }}
    <script type="application/javascript">
        function popUp(url) {
            var win = window.open(url, 'Update Connection', 'width=972,height=660,modal=yes,alwaysRaised=yes');
            var checkConnect = setInterval(function () {
                if (!win || !win.closed) return;
                clearInterval(checkConnect);
                window.location.reload();
            }, 100);
        }

        $('.testConnectionButton').click(function (e) {
            var button = $(this);
            var connector_id = 1;
            $.ajax({
                method: "POST",
                url: "{% url 'connection:test' connector_id=1 %}",
                data: {connection_id: $(button).attr('connection_id')},
            }).done(function (response) {
                if (response.test == true)
                    $(button).css('background-color', 'green');
                else
                    $(button).css('background-color', 'red');

            });
            return false;
        })
    </script>
{% endblock %}
