{% extends 'commons/site_base.html' %}
{% load static %}

{% block scripts %}
    {{ block.super }}
    <script>
        $(document).ready(function () {
            $('select#spreadsheet').on('change', function () {
                getSpreadsheetInfo($(this).val())
            });

            $('#sheet-selector').on('change', 'select#sheet', function () {
                getSpreadsheetValues($('select#spreadsheet option:selected').val(), $(this).val())
            })
        });

        function getSpreadsheetInfo(_id) {
            var url = '/account/async/spreadsheet/info/ID/'.replace('ID', _id);
            var callback = function (response) {
                if (response.Success == true) {
                    $('#sheet-selector').html(response.sheets)
                }
            };
            getData(url, callback);
        }

        function getSpreadsheetValues(_id, sheet_id) {
            var url = '/account/async/spreadsheet/values/ID/SHEET/'.replace('ID', _id).replace('SHEET', sheet_id);
            var callback = function (response) {
                if (response.Success == true) {
                    $('#column-count').text(response.Data.ColumnCount);
                    $('#row-count').text(response.Data.RowCount);
                    $('#table').html(response.Data.Table)
                }
            };
            getData(url, callback);
        }

        function getData(url, callback) {
            $.ajax({
                url: url,
                type: 'GET',
                success: function (response) {
                    callback(response);
                }
            });
        }
    </script>
{% endblock %}

{% block body %}
    DASHBOARD MAIN
    <select id="spreadsheet">
        {% for s in sheets %}
            <option value="{{ s.0 }}">{{ s.1 }}</option>
        {% endfor %}
    </select>
    <div id="sheet-selector"></div>
    COLUMNAS <span id="column-count"></span>
    FILAS <span id="row-count"></span>
    <div id="table"></div>
{% endblock %}