{% extends 'connection/create.html' %}
{% load bootstrap_tags %}


{% block body_content %}
    <form id="formCreateConnection" class="create-connection-form form-horizontal" action=""
          method="post" autocomplete="off">
        {% csrf_token %}
        {{ form|as_bootstrap }}
        <button id="btnTestConnection">Test connection</button>
        <div id="connectionTestResult"></div>
        <button id="btnCreateConnection" disabled="disabled">Create connection</button>
        {% if form.error %}
            <div class="error">{{ form.error }}</div>
        {% endif %}
    </form>
{% endblock %}


{% block scripts %}
    {{ block.super }}
    <script type="application/javascript">

        $(document).ready(function () {
            $('button#btnTestConnection').click(function () {
                $.ajax({
                    method: "POST",
                    url: "{% url 'connection:ajax_update_getresponse_test_connection' %}",
                    data: $('form#formCreateConnection').serialize()
                }).done(function (response) {
                    if (response.data) {
                        $('div#connectionTestResult').html('<p>Connection is valid.</p>');
                        $('button#btnCreateConnection').prop("disabled", false);
                    }
                });
                return false;
            })
        })
    </script>
{% endblock %}